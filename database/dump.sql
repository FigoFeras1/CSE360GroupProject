-- H2 2.1.214;
-- noinspection ALL
;              
CREATE USER IF NOT EXISTS "ADMIN" SALT 'd47276c9f03c5f49' HASH '6f451e0d2b4107a6198ab383afabcddd18e13be9927782aeabdbbfa3ecd7dbef' ADMIN;       
CREATE SCHEMA IF NOT EXISTS "ORDERS" AUTHORIZATION "ADMIN";    
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "ID" BIGINT NOT NULL,
    "FIRST_NAME" CHARACTER VARYING(32) NOT NULL,
    "LAST_NAME" CHARACTER VARYING(32) NOT NULL,
    "PASSWORD" CHARACTER VARYING(64) NOT NULL,
    "ROLE" CHARACTER VARYING(16) DEFAULT 'customer' NOT NULL
);
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("ID");         
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.USERS;    
INSERT INTO "PUBLIC"."USERS" VALUES
(1000000000, 'feras', 'a', 'password', 'customer');
CREATE CACHED TABLE "ORDERS"."ACCEPTED"(
    -- noinspection ALL
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 3) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "COST" NUMERIC(5, 2) DEFAULT 0.00 NOT NULL,
    "CUSTOMER_ID" BIGINT
);       
ALTER TABLE "ORDERS"."ACCEPTED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_A" PRIMARY KEY("ID");      
-- 1 +/- SELECT COUNT(*) FROM ORDERS.ACCEPTED; 
INSERT INTO "ORDERS"."ACCEPTED" VALUES
(1, JSON '"{\"items\":[{\"@class\":\"PIZZA\",\"quantity\":4,\"cost\":0.0,\"size\":\"MEDIUM\",\"base\":\"CHEESE\",\"toppings\":[\"EXTRA_CHEESE\",\"PINEAPPLE\"]},{\"@class\":\"PIZZA\",\"quantity\":1,\"cost\":0.0,\"size\":\"XLARGE\",\"base\":\"CHEESE\",\"toppings\":[\"EXTRA_CHEESE\"]}]}"', DATE '2022-11-11', 45.33, 1000000000);  
CREATE CACHED TABLE "ORDERS"."READY_TO_COOK"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "COST" NUMERIC(5, 2) DEFAULT 0.00 NOT NULL,
    "CUSTOMER_ID" BIGINT
); 
ALTER TABLE "ORDERS"."READY_TO_COOK" ADD CONSTRAINT "ORDERS"."CONSTRAINT_2" PRIMARY KEY("ID"); 
-- 1 +/- SELECT COUNT(*) FROM ORDERS.READY_TO_COOK;            
INSERT INTO "ORDERS"."READY_TO_COOK" VALUES
(2, JSON '"{\"items\":[{\"@class\":\"PIZZA\",\"quantity\":2,\"cost\":0.0,\"size\":\"SMALL\",\"base\":\"CHEESE\",\"toppings\":[\"OLIVES\",\"PINEAPPLE\"]},{\"@class\":\"PIZZA\",\"quantity\":2,\"cost\":0.0,\"size\":\"SMALL\",\"base\":\"CHEESE\",\"toppings\":[\"MUSHROOMS\"]}]}"', DATE '2022-11-11', 20.57, 1000000000);        
CREATE CACHED TABLE "ORDERS"."COOKING"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "COST" NUMERIC(5, 2) DEFAULT 0.00 NOT NULL,
    "CUSTOMER_ID" BIGINT
);       
ALTER TABLE "ORDERS"."COOKING" ADD CONSTRAINT "ORDERS"."CONSTRAINT_6" PRIMARY KEY("ID");       
-- 0 +/- SELECT COUNT(*) FROM ORDERS.COOKING;  
CREATE CACHED TABLE "ORDERS"."READY"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "COST" NUMERIC(5, 2) DEFAULT 0.00 NOT NULL,
    "CUSTOMER_ID" BIGINT
);         
ALTER TABLE "ORDERS"."READY" ADD CONSTRAINT "ORDERS"."CONSTRAINT_4" PRIMARY KEY("ID");         
-- 0 +/- SELECT COUNT(*) FROM ORDERS.READY;    
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."VALID_ID" CHECK(("ID" >= CAST(1000000000 AS BIGINT))
    AND ("ID" <= 9999999999)) NOCHECK;              
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."VALID_ACCOUNT_TYPE" CHECK(LOWER("ROLE") IN('customer', 'customer service', 'chef')) NOCHECK;             
ALTER TABLE "ORDERS"."READY" ADD CONSTRAINT "ORDERS"."CONSTRAINT_4A" UNIQUE("ID");             
ALTER TABLE "ORDERS"."ACCEPTED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_AE" UNIQUE("ID");          
ALTER TABLE "ORDERS"."COOKING" ADD CONSTRAINT "ORDERS"."CONSTRAINT_63" UNIQUE("ID");           
ALTER TABLE "ORDERS"."READY_TO_COOK" ADD CONSTRAINT "ORDERS"."CONSTRAINT_2A" UNIQUE("ID");     
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4D" UNIQUE("ID");             
ALTER TABLE "ORDERS"."ACCEPTED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_AEB" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK; 
ALTER TABLE "ORDERS"."COOKING" ADD CONSTRAINT "ORDERS"."CONSTRAINT_638" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;  
ALTER TABLE "ORDERS"."READY_TO_COOK" ADD CONSTRAINT "ORDERS"."CONSTRAINT_2A7" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;            
ALTER TABLE "ORDERS"."READY" ADD CONSTRAINT "ORDERS"."CONSTRAINT_4A3" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;    
