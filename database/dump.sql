-- H2 2.1.214; 
;              
CREATE USER IF NOT EXISTS "ADMIN" SALT 'd47276c9f03c5f49' HASH '6f451e0d2b4107a6198ab383afabcddd18e13be9927782aeabdbbfa3ecd7dbef' ADMIN;       
CREATE SCHEMA IF NOT EXISTS "ORDERS" AUTHORIZATION "ADMIN";    
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "ID" INTEGER NOT NULL,
    "FIRST_NAME" CHARACTER VARYING(32) NOT NULL,
    "LAST_NAME" CHARACTER VARYING(32) NOT NULL,
    "PASSWORD" CHARACTER VARYING(64) NOT NULL,
    "ROLE" CHARACTER VARYING(16) DEFAULT 'customer' NOT NULL
);               
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("ID");         
-- 2 +/- SELECT COUNT(*) FROM PUBLIC.USERS;    
INSERT INTO "PUBLIC"."USERS" VALUES
(0, 'admin', 'admin', 'password', 'CUSTOMER'),
(10, 'feras', 'a', 'password', 'CUSTOMER'); 
CREATE CACHED TABLE "ORDERS"."SAVED"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "CUSTOMER_ID" INTEGER
);        
ALTER TABLE "ORDERS"."SAVED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_4" PRIMARY KEY("ID");         
-- 0 +/- SELECT COUNT(*) FROM ORDERS.SAVED;    
CREATE CACHED TABLE "ORDERS"."PENDING"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 2) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "CUSTOMER_ID" INTEGER
);       
ALTER TABLE "ORDERS"."PENDING" ADD CONSTRAINT "ORDERS"."CONSTRAINT_2" PRIMARY KEY("ID");       
-- 1 +/- SELECT COUNT(*) FROM ORDERS.PENDING;  
INSERT INTO "ORDERS"."PENDING" VALUES
(1, JSON '"{\"size\":\"LARGE\",\"base\":\"CHEESE\",\"toppings\":[\"MUSHROOMS\",\"ONIONS\"]}"', DATE '2022-11-07', 10);   
CREATE CACHED TABLE "ORDERS"."PROCESSED"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "CUSTOMER_ID" INTEGER
);    
ALTER TABLE "ORDERS"."PROCESSED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_6" PRIMARY KEY("ID");     
-- 0 +/- SELECT COUNT(*) FROM ORDERS.PROCESSED;
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."VALID_ACCOUNT_TYPE" CHECK(LOWER("ROLE") IN('customer', 'customer service', 'chef')) NOCHECK;             
ALTER TABLE "ORDERS"."PENDING" ADD CONSTRAINT "ORDERS"."CONSTRAINT_21" UNIQUE("ID");           
ALTER TABLE "ORDERS"."SAVED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_4B" UNIQUE("ID");             
ALTER TABLE "ORDERS"."PROCESSED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_64" UNIQUE("ID");         
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4D" UNIQUE("ID");             
ALTER TABLE "ORDERS"."PROCESSED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_64D" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;
ALTER TABLE "ORDERS"."PENDING" ADD CONSTRAINT "ORDERS"."CONSTRAINT_21C" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;  
ALTER TABLE "ORDERS"."SAVED" ADD CONSTRAINT "ORDERS"."CONSTRAINT_4B0" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;    
