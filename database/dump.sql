-- H2 2.1.214;
;             
CREATE USER IF NOT EXISTS "ADMIN" SALT 'd47276c9f03c5f49' HASH '6f451e0d2b4107a6198ab383afabcddd18e13be9927782aeabdbbfa3ecd7dbef' ADMIN;      
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "ID" INTEGER NOT NULL,
    "FIRST_NAME" CHARACTER VARYING(32) NOT NULL,
    "LAST_NAME" CHARACTER VARYING(32) NOT NULL,
    "PASSWORD" CHARACTER VARYING(64) NOT NULL,
    "ROLE" CHARACTER VARYING(16) DEFAULT 'customer' NOT NULL
);        
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("ID");        
-- 1 +/- SELECT COUNT(*) FROM PUBLIC.USERS;   
INSERT INTO "PUBLIC"."USERS" VALUES
(10, 'feras', 'a', 'password', 'customer');              
CREATE CACHED TABLE "PUBLIC"."SAVED_ORDERS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "CUSTOMER_ID" INTEGER
);           
ALTER TABLE "PUBLIC"."SAVED_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_1" PRIMARY KEY("ID"); 
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.SAVED_ORDERS;            
CREATE CACHED TABLE "PUBLIC"."PENDING_ORDERS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "CUSTOMER_ID" INTEGER
);         
ALTER TABLE "PUBLIC"."PENDING_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_9" PRIMARY KEY("ID");               
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PENDING_ORDERS;          
CREATE CACHED TABLE "PUBLIC"."PROCESSED_ORDERS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "ITEMS" JSON NOT NULL,
    "ORDER_DATE" DATE NOT NULL,
    "CUSTOMER_ID" INTEGER
);       
ALTER TABLE "PUBLIC"."PROCESSED_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A" PRIMARY KEY("ID");             
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.PROCESSED_ORDERS;        
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."VALID_ACCOUNT_TYPE" CHECK(LOWER("ROLE") IN('customer', 'customer service', 'chef')) NOCHECK;            
ALTER TABLE "PUBLIC"."SAVED_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_18" UNIQUE("ID");     
ALTER TABLE "PUBLIC"."PROCESSED_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_AD" UNIQUE("ID"); 
ALTER TABLE "PUBLIC"."PENDING_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_95" UNIQUE("ID");   
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4D" UNIQUE("ID");            
ALTER TABLE "PUBLIC"."PROCESSED_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_AD9" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;        
ALTER TABLE "PUBLIC"."SAVED_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_187" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;            
ALTER TABLE "PUBLIC"."PENDING_ORDERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_95A" FOREIGN KEY("CUSTOMER_ID") REFERENCES "PUBLIC"."USERS"("ID") NOCHECK;          
